#!/bin/bash
# TinyClaw CLI Wrapper
# This wrapper allows tinyclaw to be run from any directory

# Resolve the real installation directory (follow symlinks)
TINYCLAW_BIN="$0"

# Follow symlinks to find the real script location
while [ -L "$TINYCLAW_BIN" ]; do
    TINYCLAW_DIR="$(cd "$(dirname "$TINYCLAW_BIN")" && pwd)"
    TINYCLAW_BIN="$(readlink "$TINYCLAW_BIN")"
    # Handle relative symlinks
    [[ "$TINYCLAW_BIN" != /* ]] && TINYCLAW_BIN="$TINYCLAW_DIR/$TINYCLAW_BIN"
done

# Get the directory where this wrapper is located
TINYCLAW_DIR="$(cd "$(dirname "$TINYCLAW_BIN")" && pwd)"

# The actual installation is one directory up from bin/
export TINYCLAW_HOME="$(dirname "$TINYCLAW_DIR")"
export TINYAGI_HOME="$TINYCLAW_HOME"

BASH_BIN="$(command -v bash)"
if [ -x "/opt/homebrew/bin/bash" ]; then
    BASH_BIN="/opt/homebrew/bin/bash"
elif [ -x "/usr/local/bin/bash" ]; then
    BASH_BIN="/usr/local/bin/bash"
fi

# Execute the main script with all arguments (compatibility alias)
if [ -f "$TINYCLAW_HOME/tinyagi.sh" ]; then
    exec "$BASH_BIN" "$TINYCLAW_HOME/tinyagi.sh" "$@"
fi
exec "$BASH_BIN" "$TINYCLAW_HOME/tinyclaw.sh" "$@"
